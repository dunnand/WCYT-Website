<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Game History by Opponent</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; margin-top: 10px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; }
    select { font-size: 1em; padding: 4px; }
  </style>
</head>
<body>
  <h1>Game History by Opponent</h1>

  <label for="opp">Select Opponent ➝ </label>
  <select id="opp">
    <option value="">– All –</option>
  </select>

  <div id="table_div"></div>

  <script>
    // **1) Configure these two constants:**
    const SPREADSHEET_ID = '1I_MFMOm1Cr78FPk_2Vd5HY8J0WaxOyVYtDUbEJwku0U';
    const DATA_GID       = '2064027631';  // your “Vs Opponent” tab

    // Load the Google Charts library
    google.charts.load('current', { packages: ['table'] });
    google.charts.setOnLoadCallback(init);

    function init() {
      populateDropdown();
      document.getElementById('opp').addEventListener('change', drawTable);
    }

    // **2) Build the opponent list** by querying column C
    function populateDropdown() {
      const q = "select C";
      const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}` +
                  `/gviz/tq?gid=${DATA_GID}&tq=${encodeURIComponent(q)}`;

      new google.visualization.Query(url).send(res => {
        const dt = res.getDataTable();
        const seen = {};
        const sel  = document.getElementById('opp');

        for (let i = 0; i < dt.getNumberOfRows(); i++) {
          const opp = dt.getValue(i, 0);
          if (opp && !seen[opp]) {
            seen[opp] = true;
            const opt = document.createElement('option');
            opt.value = opp;
            opt.text  = opp;
            sel.appendChild(opt);
          }
        }
        // draw unfiltered on first load
        drawTable();
      });
    }

    // **3) Query & render the table** (filtering on C “contains” the selection)
    function drawTable() {
      const sel = document.getElementById('opp').value;
      let q    = "select A,B,C,D,E,F,G,H"; 

      if (sel) {
        q += " where C contains '" + sel.replace(/'/g,"\\'") + "'";
      }

      const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}` +
                  `/gviz/tq?gid=${DATA_GID}&tq=${encodeURIComponent(q)}`;

      new google.visualization.Query(url).send(res => {
        const data  = res.getDataTable();
        const table = new google.visualization.Table(
                        document.getElementById('table_div'));
        table.draw(data, {
          showRowNumber: false,
          width: '100%',
          height: 'auto'
        });
      });
    }
  </script>
</body>
</html>


